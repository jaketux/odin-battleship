import{player,computer,game,playRound}from"./gamecontroller.js";import"./styles.css";import missImage from"./icons/miss.svg";import hitImage from"./icons/hit.svg";import boatsImage from"./icons/boat.svg";const shipSelection=document.querySelector(".ship-selection-section");function createDisplay(e){turnText.style.display="block",updateTurnText(),document.querySelector(".gameboard-box").classList.remove("invisible"),commenceButton.classList.add("invisible"),document.querySelector(".input-box").style.display="none",shipSelection.style.display="none",document.querySelector(".opponent-section").style.display="block";const t=document.querySelector(".player-game-grid"),n=document.querySelector(".opponent-game-grid"),o="player"===e?t:n;o.innerHTML="";const a="player"===e?player.getGameBoard():computer.getGameBoard();for(let t=0;t<a.length;t++)for(let n=0;n<a[t].length;n++){const s=document.createElement("div");if(s.classList.add("grid-game-square"),s.id=`square-${t}-${n}`,s.replaceWith(s.cloneNode(!0)),s.addEventListener("click",(function(){const e=s.id,t=parseInt(e.charAt(e.length-3)),n=parseInt(e.charAt(e.length-1));playRound(t,n),createDisplay("player"),createDisplay("opponent")})),"player"===e){if("No hit"===a[t][n]){const e=document.createElement("img");e.src=missImage,e.classList.add("small-icon"),s.appendChild(e)}else if("Hit"===a[t][n]){const e=document.createElement("img");e.src=hitImage,e.classList.add("small-icon"),s.classList.add("hit-boat"),s.style.pointerEvents="none",s.appendChild(e)}else if(a[t][n]&&"No hit"!==a[t][n]&&"Hit"!==a[t][n]){const e=document.createElement("img");e.src=boatsImage,e.classList.add("small-icon"),s.classList.add("contains-boat"),s.appendChild(e)}}else if("No hit"===a[t][n]){const e=document.createElement("img");e.src=missImage,e.classList.add("small-icon"),s.style.cursor="not-allowed",s.appendChild(e)}else if("Hit"===a[t][n]){const e=document.createElement("img");e.src=hitImage,e.classList.add("small-icon"),s.classList.add("hit-boat"),s.style.cursor="not-allowed",s.appendChild(e)}else s.style.cursor="pointer";o.appendChild(s)}}function createPreDisplay(){document.querySelector(".gameboard-box").classList.remove("invisible"),document.querySelector(".input-box").style.display="none",turnText.style.display="none",shipSelection.style.display="block";const e=document.querySelector(".player-game-grid"),t=document.querySelector(".opponent-section");t&&(t.style.display="none"),e.innerHTML="";const n=player.getGameBoard();for(let t=0;t<n.length;t++)for(let o=0;o<n[t].length;o++){const a=document.createElement("div");if(a.classList.add("grid-game-square"),a.id=`square-${t}-${o}`,n[t][o]&&"No hit"!==n[t][o]&&"Hit"!==n[t][o]){const e=document.createElement("img");e.src=boatsImage,e.classList.add("small-icon"),a.classList.add("contains-boat"),a.appendChild(e)}e.appendChild(a)}commenceButton.classList.remove("invisible")}const randomiseButton=document.querySelector(".random");randomiseButton.addEventListener("click",(function(){document.querySelector(".player-game-grid").innerHTML="",player.resetBoard(),player.placeAllShipsRandom(),draggableIds.forEach((e=>{const t=document.getElementById(e);t&&t.classList.add("placed")})),createPreDisplay()}));const rotateButton=document.querySelector(".rotate"),shipsBox=document.querySelector("#ships-box");rotateButton.addEventListener("click",(function(){shipsBox.classList.contains("horizontal")?(shipsBox.classList.remove("horizontal"),shipsBox.classList.add("vertical")):shipsBox.classList.contains("vertical")&&(shipsBox.classList.remove("vertical"),shipsBox.classList.add("horizontal")),"horizontal"===currentOrientation?(currentOrientation="vertical",console.log(currentOrientation)):"vertical"===currentOrientation&&(currentOrientation="horizontal",console.log(currentOrientation))}));const resetButton=document.querySelector(".reset");resetButton.addEventListener("click",(function(){document.querySelector(".player-game-grid").innerHTML="",player.resetBoard(),draggableIds.forEach((e=>{const t=document.getElementById(e);if(t){t.draggable=!0,t.style.cursor="grab",t.classList.remove("placed");const n=player.shipObjects[e];n&&(n.shipPlaced=!1,console.log(n))}})),createPreDisplay()}));const turnText=document.querySelector(".turn-text");function updateTurnText(){const e=document.querySelector("#player-name").value;if(0!==game.returnWinner()){const t=document.querySelector("#restart-btn");t.classList.remove("invisible"),"Player"===game.returnWinner()?turnText.textContent=e+" has won the game! Click Restart Game to play again.":"Computer"===game.returnWinner()&&(turnText.textContent="Computer has won the game! Click Restart Game to play again."),t.addEventListener("click",(function(){game.startNewGame(),draggableIds.forEach((e=>{const t=document.getElementById(e);if(t){t.draggable=!0,t.style.cursor="grab",t.classList.remove("placed");const n=player.shipObjects[e];n&&(n.shipPlaced=!1,console.log(n))}})),createPreDisplay(),t.classList.add("invisible")}))}else"Player"===game.getActivePlayer()?turnText.textContent=e+"'s turn to move!":turnText.textContent="Computer's turn to move!"}let currentOrientation="horizontal";const startButton=document.querySelector("#start-btn");startButton.addEventListener("click",(function(){createPreDisplay()}));const commenceButton=document.querySelector("#commence-btn");commenceButton.addEventListener("click",(function(){computer.placeAllShipsRandom(),createDisplay("player"),createDisplay("opponent")}));let draggedElement=null,initialPosition={x:0,y:0,parent:null};const draggableIds=["carrierShip","battleShip","destroyerShip","submarineShip","patrolBoatShip"];function moveAt(e,t){draggedElement.style.left=e+"px",draggedElement.style.top=t+"px"}draggableIds.forEach((e=>{const t=document.getElementById(e);t&&t.addEventListener("mousedown",(e=>{draggedElement=e.target;const t=draggedElement.getBoundingClientRect();initialPosition={x:t.left,y:t.top,parent:draggedElement.parentElement},draggedElement.style.position="absolute",draggedElement.style.pointerEvents="none",document.body.appendChild(draggedElement),moveAt(e.pageX,e.pageY)}))})),document.addEventListener("mousemove",(e=>{draggedElement&&moveAt(e.pageX,e.pageY)})),document.addEventListener("mouseup",(e=>{if(draggedElement){const t=document.elementFromPoint(e.clientX,e.clientY);if(t&&t.classList.contains("grid-game-square")){const e=t.id,n=parseInt(e.charAt(e.length-3)),o=parseInt(e.charAt(e.length-1)),a=player.shipObjects[draggedElement.id];a?(player.placeShip(a,n,o,currentOrientation),createPreDisplay(),(a.shipPlaced="true")&&draggedElement.classList.add("placed")):console.error("No matching ship found")}draggedElement.style.left=initialPosition.x+"px",draggedElement.style.top=initialPosition.y+"px",draggedElement.style.position="",draggedElement.style.pointerEvents="",initialPosition.parent.appendChild(draggedElement),draggedElement.draggable=!1,draggedElement.style.cursor="not-allowed",draggedElement=null}}));export{createDisplay,updateTurnText,createPreDisplay};